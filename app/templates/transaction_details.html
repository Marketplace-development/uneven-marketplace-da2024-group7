<!-- templates/transaction_details.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transaction Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>

    <!-- Include the Header -->
    {% include 'header.html' %}
    {% include 'notifications_flask.html' %}

    <div class="container my-5">
        <h2>Transaction Details</h2>
        <p><strong>Transaction ID:</strong> {{ transaction.id }}</p>
        <p><strong>Status:</strong> {{ transaction.status }}</p>
        <p><strong>Listing Title:</strong> {{ transaction.listing.listing_title }}</p>
        <p><strong>Price:</strong> €{{ "%.2f"|format(transaction.listing.price_per_day) }}</p>
        <p><strong>Start Date:</strong> {{ transaction.start_date }}</p>
        <p><strong>End Date:</strong> {{ transaction.end_date }}</p>
        <p><strong>Total Price:</strong> €{{ "%.2f"|format(transaction.total_price) }}</p>
        <p><strong>Created At:</strong> {{ transaction.created_at }}</p>
    
        <!-- Renter's View -->
        {% if is_renter %}
            <h3>Your Review</h3>
            {% if existing_review %}
                <p><strong>Rating:</strong> {{ existing_review.rating }} / 5</p>
                <p><strong>Comment:</strong> {{ existing_review.comment }}</p>
                <p class="text-muted"><i>Review left on {{ existing_review.created_at }}</i></p>
            {% elif can_review %}
                <form method="POST" action="{{ url_for('main.transaction_details', transaction_id=transaction.id) }}">
                    <div class="mb-3">
                        <label for="rating" class="form-label">Rating (1-5)</label>
                        <input type="number" name="rating" id="rating" class="form-control" min="1" max="5" required>
                    </div>
                    <div class="mb-3">
                        <label for="comment" class="form-label">Comment</label>
                        <textarea name="comment" id="comment" class="form-control" rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Review</button>
                </form>
            {% else %}
                <p class="text-muted">You cannot leave a review at this time.</p>
            {% endif %}
        {% endif %}
    
        <!-- Provider's View -->
        {% if is_provider %}
            <h3>Feedback Received</h3>
            {% if received_reviews %}
                <ul>
                    {% for review in received_reviews %}
                        <li>
                            <p><strong>Rating:</strong> {{ review.rating }} / 5</p>
                            <p><strong>Comment:</strong> {{ review.comment }}</p>
                            <p class="text-muted"><i>Reviewed by {{ review.reviewer.username }} on {{ review.created_at }}</i></p>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted">No feedback received yet.</p>
            {% endif %}
        {% endif %}
    
        <a href="{{ url_for('main.index') }}" class="btn btn-secondary mt-3">Return to Home</a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
